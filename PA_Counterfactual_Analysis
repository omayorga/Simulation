"""\nPennsylvania Higher Education Economic Impact: Comprehensive Counterfactual Analysis\nHistorical Analysis (1980-2026) with Monte Carlo Simulation (1,000,000 iterations)\n\nAuthor: Oscar J. Mayorga\nUpdated: February 17, 2026\nRepository: github.com/omayorga/Simulation\n\nData Sources:\n- SHEEO State Higher Education Finance (SHEF) 1980-2026\n- PASSHE Enrollment Reports\n- Federal Reserve/TICAS Student Debt Data\n- BLS Graduate Earnings Data\n- PA Budget Office Historical Appropriations\n- Institutional Reports (Deferred Maintenance)\n"""\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom pathlib import Path\nfrom scipy import stats\nimport warnings\nwarnings.filterwarnings('ignore')\n\n# Set style\nsns.set_style(\"whitegrid\")\nplt.rcParams['figure.figsize'] = (14, 8)\nnp.random.seed(42)\n\nprint(\"=\" * 80)\nprint(\"PENNSYLVANIA HIGHER EDUCATION COUNTERFACTUAL ANALYSIS\")\nprint(\"Historical Data (1980-2026) + Monte Carlo Simulation (1,000,000 iterations)\")\nprint(\"=\" * 80)\nprint(f\"\\nAnalysis Start: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\")\nprint(\"=\" * 80 + \"\\n\")\n\n# ============================================================================\n# HISTORICAL DATA (1980-2026)\n# Sources: SHEEO SHEF, PASSHE Reports, Federal Reserve, BLS\n# ============================================================================\n\nyears = np.arange(1980, 2027)\nn_years = len(years)\n\n# CPI inflation multipliers (base year 2024)\ncpi_multipliers = {\n    1980: 3.23, 1985: 2.51, 1990: 2.07, 1995: 1.76, 2000: 1.49,\n    2005: 1.31, 2010: 1.18, 2015: 1.08, 2020: 1.06, 2021: 1.01,\n    2022: 0.93, 2023: 0.90, 2024: 0.87, 2025: 0.85, 2026: 0.83\n}\n\n# State appropriations per FTE (SHEEO SHEF data)\n# 1980 baseline: $12,000 per FTE (2024 dollars)\n# 2024 actual: $7,164 per FTE (40.3% decline)\nappropriations_per_fte_real = {\n    1980: 12000, 1985: 11200, 1990: 10800, 1995: 10200, 2000: 9800,\n    2005: 9200, 2010: 8500, 2015: 7800, 2020: 7400, 2021: 7300,\n    2022: 7250, 2023: 7200, 2024: 7164, 2025: 7100, 2026: 7050\n}\n\n# Total enrollment (all PA public higher ed)\n# PASSHE declined 30.8% from 2010-2023\ntotal_enrollment = {\n    1980: 320000, 1985: 340000, 1990: 365000, 1995: 385000, 2000: 405000,\n    2005: 425000, 2010: 450000, 2015: 420000, 2020: 395000, 2021: 385000,\n    2022: 375000, 2023: 365000, 2024: 360000, 2025: 358000, 2026: 355000\n}\n\n# PASSHE-specific enrollment\npasshe_enrollment = {\n    1980: 85000, 1985: 90000, 1990: 95000, 1995: 98000, 2000: 102000,\n    2005: 106000, 2010: 110000, 2015: 95000, 2020: 82000, 2021: 78000,\n    2022: 76000, 2023: 76180, 2024: 75500, 2025: 75000, 2026: 74500\n}\n\n# Average tuition (public 4-year, 2024 dollars)\navg_tuition = {\n    1980: 4200, 1985: 5100, 1990: 6200, 1995: 7400, 2000: 8800,\n    2005: 10500, 2010: 12800, 2015: 14200, 2020: 14800, 2021: 15000,\n    2022: 15150, 2023: 15200, 2024: 15240, 2025: 15400, 2026: 15600\n}\n\n# Student share of total costs (SHEEO)\nstudent_cost_share = {\n    1980: 0.32, 1985: 0.36, 1990: 0.40, 1995: 0.44, 2000: 0.48,\n    2005: 0.52, 2010: 0.56, 2015: 0.59, 2020: 0.61, 2021: 0.62,\n    2022: 0.625, 2023: 0.628, 2024: 0.630, 2025: 0.632, 2026: 0.635\n}\n\n# Average student debt at graduation (Federal Reserve/TICAS)\navg_student_debt = {\n    1980: 2500, 1985: 4200, 1990: 7800, 1995: 12500, 2000: 17800,\n    2005: 19400, 2010: 25250, 2015: 30100, 2020: 32600, 2021: 33200,\n    2022: 33800, 2023: 34200, 2024: 34500, 2025: 34800, 2026: 35000\n}\n\n# Deferred maintenance backlog (billions, 2024 dollars)\ndeferred_maintenance = {\n    1980: 0.5, 1985: 0.8, 1990: 1.2, 1995: 1.8, 2000: 2.5,\n    2005: 3.2, 2010: 4.0, 2015: 4.9, 2020: 5.8, 2021: 6.0,\n    2022: 6.2, 2023: 6.4, 2024: 6.5, 2025: 6.7, 2026: 6.9\n}\n\n# Graduate earnings (BLS data, 2024 dollars)\nearnings_ba = 66368  # Penn State 2-year post-grad median\nearnings_hs = 35000  # High school diploma\nlifetime_earnings_premium = 900000  # BA vs HS over career\n\n# State income tax rate\npa_income_tax_rate = 0.0307\n\n# ============================================================================\n# MONTE CARLO SIMULATION PARAMETERS\n# ============================================================================\n\nN_SIMULATIONS = 1000000\nprint(f\"Monte Carlo Simulations: {N_SIMULATIONS:,}\")\nprint(\"\\nParameter Uncertainty Ranges:\")\n\n# Parameter distributions for uncertainty\nELASTICITY_MEAN = -0.037\nELASTICITY_STD = 0.015\nprint(f\"  Enrollment Elasticity: {ELASTICITY_MEAN:.3f} ± {ELASTICITY_STD:.3f}\")\n\nROI_MULTIPLIER_MEAN = 6.5\nROI_MULTIPLIER_STD = 1.2\nprint(f\"  ROI Multiplier: {ROI_MULTIPLIER_MEAN:.1f} ± {ROI_MULTIPLIER_STD:.1f}\")\n\nDIRECT_SPENDING_MULTIPLIER_MEAN = 2.20\nDIRECT_SPENDING_MULTIPLIER_STD = 0.25\nprint(f\"  Direct Spending Multiplier: {DIRECT_SPENDING_MULTIPLIER_MEAN:.2f} ± {DIRECT_SPENDING_MULTIPLIER_STD:.2f}\")\n\nEMPLOYMENT_MULTIPLIER_MEAN = 1.65\nEMPLOYMENT_MULTIPLIER_STD = 0.20\nprint(f\"  Employment Multiplier: {EMPLOYMENT_MULTIPLIER_MEAN:.2f} ± {EMPLOYMENT_MULTIPLIER_STD:.2f}\")\n\nGRADUATION_RATE_MEAN = 0.62\nGRADUATION_RATE_STD = 0.05\nprint(f\"  Graduation Rate: {GRADUATION_RATE_MEAN:.2f} ± {GRADUATION_RATE_STD:.2f}\")\n\nprint(\"\\n\" + \"=\" * 80)\n\n# ============================================================================\n# COUNTERFACTUAL MODELING FUNCTIONS\n# ============================================================================\n\ndef interpolate_data(data_dict, years):\n    \"\"\"Interpolate data for all years\"\"\"\n    known_years = sorted(data_dict.keys())\n    known_values = [data_dict[y] for y in known_years]\n    return np.interp(years, known_years, known_values)\n\ndef scenario_a_actual(years):\n    \"\"\"Actual historical path (disinvestment)\"\"\"\n    return {\n        'appropriations': interpolate_data(appropriations_per_fte_real, years),\n        'enrollment': interpolate_data(total_enrollment, years),\n        'tuition': interpolate_data(avg_tuition, years),\n        'debt': interpolate_data(avg_student_debt, years),\n        'maintenance': interpolate_data(deferred_maintenance, years),\n        'student_share': interpolate_data(student_cost_share, years)\n    }\n\ndef scenario_b_counterfactual(years, elasticity):\n    \"\"\"Counterfactual: maintained 1980 funding levels + inflation + enrollment\"\"\"\n    base_appropriation = 12000  # 1980 level in 2024 dollars\n    base_enrollment = 320000\n    \n    # Maintain per-FTE funding at 1980 level\n    cf_appropriations = np.full(len(years), base_appropriation)\n    \n    # Calculate enrollment with maintained funding\n    actual = scenario_a_actual(years)\n    tuition_diff = actual['tuition'] - interpolate_data(avg_tuition, [1980])[0]\n    enrollment_effect = 1 + (elasticity * (tuition_diff / actual['tuition'][0]))\n    cf_enrollment = base_enrollment * enrollment_effect\n    cf_enrollment = np.maximum(cf_enrollment, actual['enrollment'])  # Can't go below actual\n    \n    # Lower tuition with maintained funding\n    cf_tuition = actual['tuition'] * (1 - 0.35)  # 35% lower with full funding\n    \n    # Lower debt burden\n    cf_debt = actual['debt'] * 0.60  # 40% reduction with maintained funding\n    \n    # Better maintained facilities\n    cf_maintenance = interpolate_data(deferred_maintenance, [1980])[0] * 1.5  # Growth but manageable\n    cf_maintenance = np.full(len(years), cf_maintenance)\n    \n    # Lower student cost share\n    cf_student_share = np.full(len(years), 0.35)  # Maintain closer to 1980 level\n    \n    return {\n        'appropriations': cf_appropriations,\n        'enrollment': cf_enrollment,\n        'tuition': cf_tuition,\n        'debt': cf_debt,\n        'maintenance': cf_maintenance,\n        'student_share': cf_student_share\n    }\n\n# ============================================================================\n# MONTE CARLO SIMULATION\n# ============================================================================\n\nprint(\"\\nRunning Monte Carlo Simulation...\")\nprint(\"This may take 30-60 seconds for 1,000,000 iterations...\")\n\n# Initialize results arrays\nfunding_shortfalls = np.zeros(N_SIMULATIONS)\nlost_graduates = np.zeros(N_SIMULATIONS)\nexcess_debt = np.zeros(N_SIMULATIONS)\nlost_tax_revenue = np.zeros(N_SIMULATIONS)\ndeferred_maintenance_excess = np.zeros(N_SIMULATIONS)\nroi_losses = np.zeros(N_SIMULATIONS)\nlost_economic_output = np.zeros(N_SIMULATIONS)\n\n# Run simulations\nfor i in range(N_SIMULATIONS):\n    # Sample parameters from distributions\n    elasticity = np.random.normal(ELASTICITY_MEAN, ELASTICITY_STD)\n    roi_mult = np.random.normal(ROI_MULTIPLIER_MEAN, ROI_MULTIPLIER_STD)\n    grad_rate = np.random.normal(GRADUATION_RATE_MEAN, GRADUATION_RATE_STD)\n    grad_rate = np.clip(grad_rate, 0.4, 0.8)\n    \n    # Calculate scenarios\n    actual = scenario_a_actual(years)\n    counterfactual = scenario_b_counterfactual(years, elasticity)\n    \n    # Funding shortfall\n    annual_shortfall = (counterfactual['appropriations'] - actual['appropriations']) * actual['enrollment']\n    funding_shortfalls[i] = np.sum(annual_shortfall) / 1e9\n    \n    # Lost graduates\n    enrollment_diff = counterfactual['enrollment'] - actual['enrollment']\n    lost_students = np.sum(np.maximum(enrollment_diff, 0))\n    lost_graduates[i] = lost_students * grad_rate / 4  # 4-year degrees\n    \n    # Excess student debt\n    debt_diff = actual['debt'] - counterfactual['debt']\n    annual_excess_debt = debt_diff * actual['enrollment'] * grad_rate\n    excess_debt[i] = np.sum(annual_excess_debt) / 1e9\n    \n    # Lost tax revenue (lifetime)\n    lost_tax_revenue[i] = (lost_graduates[i] * lifetime_earnings_premium * \n                           pa_income_tax_rate * 0.7) / 1e9  # 70% stay in PA\n    \n    # Deferred maintenance excess\n    maintenance_diff = actual['maintenance'][-1] - counterfactual['maintenance'][-1]\n    deferred_maintenance_excess[i] = maintenance_diff\n    \n    # ROI loss\n    roi_losses[i] = funding_shortfalls[i] * roi_mult\n    \n    # Lost economic output\n    lost_economic_output[i] = lost_graduates[i] * lifetime_earnings_premium / 1e9\n    \n    # Progress indicator\n    if (i + 1) % 100000 == 0:\n        print(f\"  Completed: {i+1:,} / {N_SIMULATIONS:,} ({(i+1)/N_SIMULATIONS*100:.1f}%)\")\n\nprint(f\"\\nSimulation Complete: {datetime.now().strftime('%H:%M:%S')}\")\nprint(\"=\" * 80)\n\n# ============================================================================\n# RESULTS ANALYSIS\n# ============================================================================\n\nresults_summary = {\n    'Metric': [\n        'Cumulative Funding Shortfall (1980-2026)',\n        'Lost College Graduates',\n        'Excess Student Debt (System-wide)',\n        'Lost State Tax Revenue (Lifetime)',\n        'Excess Deferred Maintenance',\n        'ROI Loss (Economic Value)',\n        'Lost Economic Output (Lifetime Earnings)'\n    ],\n    'Mean': [\n        f'${funding_shortfalls.mean():.1f}B',\n        f'{lost_graduates.mean()/1000:.0f}K',\n        f'${excess_debt.mean():.1f}B',\n        f'${lost_tax_revenue.mean():.1f}B',\n        f'${deferred_maintenance_excess.mean():.1f}B',\n        f'${roi_losses.mean():.1f}B',\n        f'${lost_economic_output.mean():.1f}B'\n    ],\n    '95% CI Lower': [\n        f'${np.percentile(funding_shortfalls, 2.5):.1f}B',\n        f'{np.percentile(lost_graduates, 2.5)/1000:.0f}K',\n        f'${np.percentile(excess_debt, 2.5):.1f}B',\n        f'${np.percentile(lost_tax_revenue, 2.5):.1f}B',\n        f'${np.percentile(deferred_maintenance_excess, 2.5):.1f}B',\n        f'${np.percentile(roi_losses, 2.5):.1f}B',\n        f'${np.percentile(lost_economic_output, 2.5):.1f}B'\n    ],\n    '95% CI Upper': [\n        f'${np.percentile(funding_shortfalls, 97.5):.1f}B',\n        f'{np.percentile(lost_graduates, 97.5)/1000:.0f}K',\n        f'${np.percentile(excess_debt, 97.5):.1f}B',\n        f'${np.percentile(lost_tax_revenue, 97.5):.1f}B',\n        f'${np.percentile(deferred_maintenance_excess, 97.5):.1f}B',\n        f'${np.percentile(roi_losses, 97.5):.1f}B',\n        f'${np.percentile(lost_economic_output, 97.5):.1f}B'\n    ],\n    'Std Dev': [\n        f'${funding_shortfalls.std():.1f}B',\n        f'{lost_graduates.std()/1000:.0f}K',\n        f'${excess_debt.std():.1f}B',\n        f'${lost_tax_revenue.std():.1f}B',\n        f'${deferred_maintenance_excess.std():.1f}B',\n        f'${roi_losses.std():.1f}B',\n        f'${lost_economic_output.std():.1f}B'\n    ]\n}\n\ndf_results = pd.DataFrame(results_summary)\n\nprint(\"\\n\" + \"=\" * 80)\nprint(\"MONTE CARLO SIMULATION RESULTS (1,000,000 iterations)\")\nprint(\"=\" * 80)\nprint(df_results.to_string(index=False))\nprint(\"=\" * 80)\n\n# Point estimates for visualization\nactual_scenario = scenario_a_actual(years)\ncf_scenario = scenario_b_counterfactual(years, ELASTICITY_MEAN)\n\nprint(\"\\n\" + \"=\" * 80)\nprint(\"KEY FINDINGS (Mean Estimates)\")\nprint(\"=\" * 80)\nprint(f\"Per-FTE Appropriations:\")\nprint(f\"  1980: $12,000 (2024 dollars)\")\nprint(f\"  2024: $7,164 (2024 dollars)\")\nprint(f\"  Decline: -40.3%\")\nprint(f\"\\nPASSHE Enrollment:\")\nprint(f\"  2010: 110,000 students\")\nprint(f\"  2023: 76,180 students\")\nprint(f\"  Decline: -30.8%\")\nprint(f\"\\nStudent Cost Share:\")\nprint(f\"  1980: 32% of total costs\")\nprint(f\"  2024: 63% of total costs\")\nprint(f\"  Increase: +97%\")\nprint(f\"\\nROI Analysis:\")\nprint(f\"  Every $1 not invested costs ${ROI_MULTIPLIER_MEAN:.1f} in economic value\")\nprint(f\"  Total ROI loss: ${roi_losses.mean():.1f}B (95% CI: ${np.percentile(roi_losses, 2.5):.1f}B - ${np.percentile(roi_losses, 97.5):.1f}B)\")\nprint(\"=\" * 80)\n\n# ============================================================================\n# SAVE RESULTS\n# ============================================================================\n\noutput_dir = Path('output')\noutput_dir.mkdir(exist_ok=True)\n\n# Save simulation results\nsim_results = pd.DataFrame({\n    'Funding_Shortfall_B': funding_shortfalls,\n    'Lost_Graduates': lost_graduates,\n    'Excess_Debt_B': excess_debt,\n    'Lost_Tax_Revenue_B': lost_tax_revenue,\n    'Deferred_Maintenance_B': deferred_maintenance_excess,\n    'ROI_Loss_B': roi_losses,\n    'Lost_Economic_Output_B': lost_economic_output\n})\nsim_results.to_csv(output_dir / 'Monte_Carlo_Results_1M.csv', index=False)\n\n# Save summary statistics\ndf_results.to_csv(output_dir / 'Summary_Statistics.csv', index=False)\n\n# Save historical data\nhistorical_df = pd.DataFrame({\n    'Year': years,\n    'Actual_Appropriations': actual_scenario['appropriations'],\n    'CF_Appropriations': cf_scenario['appropriations'],\n    'Actual_Enrollment': actual_scenario['enrollment'],\n    'CF_Enrollment': cf_scenario['enrollment'],\n    'Actual_Tuition': actual_scenario['tuition'],\n    'CF_Tuition': cf_scenario['tuition'],\n    'Actual_Debt': actual_scenario['debt'],\n    'CF_Debt': cf_scenario['debt']\n})\nhistorical_df.to_csv(output_dir / 'Historical_Data_Scenarios.csv', index=False)\n\nprint(\"\\n\" + \"=\" * 80)\nprint(\"FILES SAVED:\")\nprint(\"  - output/Monte_Carlo_Results_1M.csv (1,000,000 simulation runs)\")\nprint(\"  - output/Summary_Statistics.csv\")\nprint(\"  - output/Historical_Data_Scenarios.csv\")\nprint(\"=\" * 80)\n\n# ============================================================================\n# VISUALIZATIONS\n# ============================================================================\n\nprint(\"\\nGenerating visualizations...\")\n\n# Figure 1: Four-panel timeline (Actual vs Counterfactual)\nfig, axes = plt.subplots(2, 2, figsize=(16, 12))\nfig.suptitle('Pennsylvania Higher Education: Actual vs. Counterfactual (1980-2026)', \n             fontsize=16, fontweight='bold', y=0.995)\n\n# Panel 1: Appropriations per FTE\nax1 = axes[0, 0]\nax1.plot(years, actual_scenario['appropriations'], 'r-', linewidth=2.5, label='Actual')\nax1.plot(years, cf_scenario['appropriations'], 'b--', linewidth=2.5, label='Counterfactual')\nax1.fill_between(years, actual_scenario['appropriations'], cf_scenario['appropriations'], \n                 alpha=0.3, color='orange')\nax1.set_title('State Appropriations per FTE', fontsize=13, fontweight='bold')\nax1.set_ylabel('Per-Student Funding ($2024)', fontsize=11)\nax1.legend(loc='upper right')\nax1.grid(alpha=0.3)\nax1.text(2023, 7500, f'-40.3%', fontsize=12, fontweight='bold', color='red')\n\n# Panel 2: Total Enrollment\nax2 = axes[0, 1]\nax2.plot(years, actual_scenario['enrollment']/1000, 'r-', linewidth=2.5, label='Actual')\nax2.plot(years, cf_scenario['enrollment']/1000, 'b--', linewidth=2.5, label='Counterfactual')\nax2.fill_between(years, actual_scenario['enrollment']/1000, cf_scenario['enrollment']/1000, \n                 alpha=0.3, color='orange')\nax2.set_title('Total Public Higher Ed Enrollment', fontsize=13, fontweight='bold')\nax2.set_ylabel('Students (thousands)', fontsize=11)\nax2.legend(loc='upper left')\nax2.grid(alpha=0.3)\n\n# Panel 3: Student Debt\nax3 = axes[1, 0]\nax3.plot(years, actual_scenario['debt'], 'r-', linewidth=2.5, label='Actual')\nax3.plot(years, cf_scenario['debt'], 'b--', linewidth=2.5, label='Counterfactual')\nax3.fill_between(years, cf_scenario['debt'], actual_scenario['debt'], \n                 alpha=0.3, color='red')\nax3.set_title('Average Student Debt at Graduation', fontsize=13, fontweight='bold')\nax3.set_ylabel('Debt ($2024)', fontsize=11)\nax3.set_xlabel('Year', fontsize=11)\nax3.legend(loc='upper left')\nax3.grid(alpha=0.3)\nax3.text(2020, 30000, f'${actual_scenario[\"debt\"][-1]:.0f}', fontsize=11, fontweight='bold', color='red')\n\n# Panel 4: Deferred Maintenance\nax4 = axes[1, 1]\nmaintenance_years = years\nax4.plot(maintenance_years, actual_scenario['maintenance'], 'r-', linewidth=2.5, label='Actual')\nax4.plot(maintenance_years, cf_scenario['maintenance'], 'b--', linewidth=2.5, label='Counterfactual')\nax4.fill_between(maintenance_years, cf_scenario['maintenance'], actual_scenario['maintenance'], \n                 alpha=0.3, color='red')\nax4.set_title('Deferred Maintenance Backlog', fontsize=13, fontweight='bold')\nax4.set_ylabel('Backlog (Billions $2024)', fontsize=11)\nax4.set_xlabel('Year', fontsize=11)\nax4.legend(loc='upper left')\nax4.grid(alpha=0.3)\n\nplt.tight_layout()\nplt.savefig(output_dir / 'Figure1_Historical_Comparison.png', dpi=300, bbox_inches='tight')\nplt.close()\n\n# Figure 2: Cumulative Impacts (with confidence intervals)\nfig, ax = plt.subplots(figsize=(14, 8))\n\nmetrics = ['Funding\\nShortfall', 'Lost\\nGraduates', 'Excess\\nDebt', \n           'Lost Tax\\nRevenue', 'Deferred\\nMaintenance', 'ROI\\nLoss']\nmeans = [\n    funding_shortfalls.mean(),\n    lost_graduates.mean()/1000,  # Convert to thousands\n    excess_debt.mean(),\n    lost_tax_revenue.mean(),\n    deferred_maintenance_excess.mean(),\n    roi_losses.mean()\n]\nci_lower = [\n    funding_shortfalls.mean() - np.percentile(funding_shortfalls, 2.5),\n    lost_graduates.mean()/1000 - np.percentile(lost_graduates, 2.5)/1000,\n    excess_debt.mean() - np.percentile(excess_debt, 2.5),\n    lost_tax_revenue.mean() - np.percentile(lost_tax_revenue, 2.5),\n    deferred_maintenance_excess.mean() - np.percentile(deferred_maintenance_excess, 2.5),\n    roi_losses.mean() - np.percentile(roi_losses, 2.5)\n]\nci_upper = [\n    np.percentile(funding_shortfalls, 97.5) - funding_shortfalls.mean(),\n    np.percentile(lost_graduates, 97.5)/1000 - lost_graduates.mean()/1000,\n    np.percentile(excess_debt, 97.5) - excess_debt.mean(),\n    np.percentile(lost_tax_revenue, 97.5) - lost_tax_revenue.mean(),\n    np.percentile(deferred_maintenance_excess, 97.5) - deferred_maintenance_excess.mean(),\n    np.percentile(roi_losses, 97.5) - roi_losses.mean()\n]\n\ncolors = ['#e74c3c', '#f39c12', '#e67e22', '#3498db', '#9b59b6', '#c0392b']\nbars = ax.bar(metrics, means, color=colors, alpha=0.8, edgecolor='black', linewidth=1.5)\nax.errorbar(metrics, means, yerr=[ci_lower, ci_upper], fmt='none', ecolor='black', \n            capsize=5, capthick=2, linewidth=2)\n\nax.set_ylabel('Impact (Billions $ or Thousands)', fontsize=13, fontweight='bold')\nax.set_title('Cumulative Economic Impact of Disinvestment (1980-2026)\\nwith 95% Confidence Intervals (1M simulations)', \n             fontsize=15, fontweight='bold')\nax.grid(axis='y', alpha=0.3)\n\n# Add value labels\nfor i, (bar, val) in enumerate(zip(bars, means)):\n    if i == 1:  # Lost Graduates in thousands\n        label = f'{val:.0f}K'\n    else:\n        label = f'${val:.1f}B'\n    ax.text(bar.get_x() + bar.get_width()/2, val + max(ci_upper)*0.05,\n           label, ha='center', va='bottom', fontsize=12, fontweight='bold')\n\nplt.tight_layout()\nplt.savefig(output_dir / 'Figure2_Cumulative_Impacts.png', dpi=300, bbox_inches='tight')\nplt.close()\n\n# Figure 3: Per-Student Burden Over Time\nfig, ax = plt.subplots(figsize=(14, 7))\n\nax.plot(years, actual_scenario['appropriations'], label='State Funding per FTE', \n        linewidth=3, color='#3498db')\nax.plot(years, actual_scenario['tuition'], label='Student Tuition Cost', \n        linewidth=3, color='#e74c3c')\nax.plot(years, actual_scenario['debt']/4, label='Annual Debt Accumulation', \n        linewidth=3, color='#f39c12', linestyle='--')\n\nax.set_xlabel('Year', fontsize=13, fontweight='bold')\nax.set_ylabel('Amount ($2024)', fontsize=13, fontweight='bold')\nax.set_title('Per-Student Financial Burden: State Support vs. Student Costs (1980-2026)', \n             fontsize=15, fontweight='bold')\nax.legend(loc='upper left', fontsize=11)\nax.grid(alpha=0.3)\n\n# Annotate crossover point\nax.annotate('State cuts force\\nstudent burden up', \n            xy=(2005, 10000), xytext=(1995, 13000),\n            arrowprops=dict(arrowstyle='->', lw=2, color='red'),\n            fontsize=11, fontweight='bold', color='red')\n\nplt.tight_layout()\nplt.savefig(output_dir / 'Figure3_Per_Student_Burden.png', dpi=300, bbox_inches='tight')\nplt.close()\n\n# Figure 4: PASSHE Enrollment Collapse\nfig, ax = plt.subplots(figsize=(12, 7))\n\npasshe_years = sorted(passhe_enrollment.keys())\npasshe_students = [passhe_enrollment[y] for y in passhe_years]\n\nax.plot(passhe_years, np.array(passhe_students)/1000, linewidth=4, color='#c0392b', marker='o')\nax.axvspan(2010, 2023, alpha=0.2, color='red')\n\nax.set_xlabel('Year', fontsize=13, fontweight='bold')\nax.set_ylabel('PASSHE Enrollment (thousands)', fontsize=13, fontweight='bold')\nax.set_title('PASSHE Enrollment Collapse (2010-2023): -30.8% Decline', \n             fontsize=15, fontweight='bold', color='#c0392b')\nax.grid(alpha=0.3)\n\n# Add annotations\nax.text(2010, 105, '110K\\n(2010)', ha='center', fontsize=11, fontweight='bold')\nax.text(2023, 71, '76.2K\\n(2023)', ha='center', fontsize=11, fontweight='bold')\nax.text(2016, 95, '-30.8%', ha='center', fontsize=16, fontweight='bold', color='red')\n\nplt.tight_layout()\nplt.savefig(output_dir / 'Figure4_PASSHE_Collapse.png', dpi=300, bbox_inches='tight')\nplt.close()\n\n# Figure 5: ROI Analysis\nfig, ax = plt.subplots(figsize=(12, 8))\n\nroi_data = [1, ROI_MULTIPLIER_MEAN]\nlabels = ['$1 Not\\nInvested', f'${ROI_MULTIPLIER_MEAN:.1f}\\nEconomic Loss']\ncolors_roi = ['#3498db', '#e74c3c']\n\nbars = ax.bar(labels, roi_data, color=colors_roi, alpha=0.8, edgecolor='black', linewidth=2)\nax.set_ylabel('Economic Value ($)', fontsize=13, fontweight='bold')\nax.set_title(f'Return on Investment: Every $1 Not Invested Costs ${ROI_MULTIPLIER_MEAN:.1f} in Economic Value',\n             fontsize=15, fontweight='bold')\nax.set_ylim(0, ROI_MULTIPLIER_MEAN * 1.2)\n\n# Add value labels\nfor bar, val in zip(bars, roi_data):\n    ax.text(bar.get_x() + bar.get_width()/2, val + 0.2,\n           f'${val:.1f}', ha='center', va='bottom', fontsize=18, fontweight='bold')\n\n# Add arrow\nax.annotate('', xy=(1.35, ROI_MULTIPLIER_MEAN*0.8), xytext=(0.65, 1.2),\n            arrowprops=dict(arrowstyle='->', lw=4, color='red'))\nax.text(1, ROI_MULTIPLIER_MEAN*0.5, f'{ROI_MULTIPLIER_MEAN:.1f}x\\nMultiplier', \n        ha='center', fontsize=14, fontweight='bold', color='red')\n\nplt.tight_layout()\nplt.savefig(output_dir / 'Figure5_ROI_Analysis.png', dpi=300, bbox_inches='tight')\nplt.close()\n\n# Figure 6: Monte Carlo Distribution (Funding Shortfall)\nfig, ax = plt.subplots(figsize=(12, 7))\n\nax.hist(funding_shortfalls, bins=100, color='#3498db', alpha=0.7, edgecolor='black')\nax.axvline(funding_shortfalls.mean(), color='red', linestyle='--', linewidth=3, \n           label=f'Mean: ${funding_shortfalls.mean():.1f}B')\nax.axvline(np.percentile(funding_shortfalls, 2.5), color='orange', linestyle='--', linewidth=2,\n           label=f'2.5%: ${np.percentile(funding_shortfalls, 2.5):.1f}B')\nax.axvline(np.percentile(funding_shortfalls, 97.5), color='orange', linestyle='--', linewidth=2,\n           label=f'97.5%: ${np.percentile(funding_shortfalls, 97.5):.1f}B')\n\nax.set_xlabel('Cumulative Funding Shortfall (Billions $)', fontsize=13, fontweight='bold')\nax.set_ylabel('Frequency', fontsize=13, fontweight='bold')\nax.set_title('Monte Carlo Distribution: Funding Shortfall (1,000,000 simulations)', \n             fontsize=15, fontweight='bold')\nax.legend(fontsize=11)\nax.grid(alpha=0.3)\n\nplt.tight_layout()\nplt.savefig(output_dir / 'Figure6_Monte_Carlo_Distribution.png', dpi=300, bbox_inches='tight')\nplt.close()\n\nprint(\"\\nVISUALIZATIONS SAVED:\")\nprint(\"  - output/Figure1_Historical_Comparison.png\")\nprint(\"  - output/Figure2_Cumulative_Impacts.png\")\nprint(\"  - output/Figure3_Per_Student_Burden.png\")\nprint(\"  - output/Figure4_PASSHE_Collapse.png\")\nprint(\"  - output/Figure5_ROI_Analysis.png\")\nprint(\"  - output/Figure6_Monte_Carlo_Distribution.png\")\nprint(\"=\" * 80)\n\nprint(f\"\\nAnalysis Complete: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\")\nprint(\"=\" * 80)\n