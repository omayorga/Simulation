"""\nPennsylvania Higher Education Economic Impact Analysis\nCounty-Level Analysis with Best-Practice Elasticity, ROI Multipliers & Inflation Adjustment\n\nAuthor: Oscar J. Mayorga\nUpdated: February 17, 2026\nRepository: github.com/omayorga/Simulation\n"""\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom pathlib import Path\nfrom datetime import datetime\n\n# Set style\nsns.set_style(\"whitegrid\")\nplt.rcParams['figure.figsize'] = (12, 8)\n\n# ============================================================================\n# INFLATION ADJUSTMENT PARAMETERS\n# Source: Bureau of Labor Statistics CPI Data (February 2026)\n# ============================================================================\n\n# Base year for analysis\nBASE_YEAR = 2024\nCURRENT_YEAR = 2026\n\n# Annual inflation rates (actual and projected)\nINFLATION_RATES = {\n    2020: 1.2,\n    2021: 4.7,\n    2022: 8.0,\n    2023: 4.1,\n    2024: 3.4,\n    2025: 2.7,  # Average for 2025\n    2026: 2.4,  # Current as of Jan 2026\n    2027: 2.2,  # Federal Reserve projection\n    2028: 2.1   # Federal Reserve projection\n}\n\ndef calculate_inflation_multiplier(from_year, to_year):\n    \"\"\"\n    Calculate cumulative inflation multiplier between two years\n    \n    Args:\n        from_year: Starting year\n        to_year: Ending year\n    \n    Returns:\n        Multiplier to adjust dollar amounts for inflation\n    \"\"\"\n    if from_year == to_year:\n        return 1.0\n    \n    multiplier = 1.0\n    years = range(from_year + 1, to_year + 1) if to_year > from_year else range(to_year + 1, from_year + 1)\n    \n    for year in years:\n        if year in INFLATION_RATES:\n            rate = INFLATION_RATES[year] / 100\n            multiplier *= (1 + rate) if to_year > from_year else (1 / (1 + rate))\n    \n    return multiplier\n\ndef adjust_for_inflation(amount, from_year=BASE_YEAR, to_year=CURRENT_YEAR):\n    \"\"\"\n    Adjust dollar amount for inflation\n    \n    Args:\n        amount: Dollar amount to adjust\n        from_year: Year of original dollars\n        to_year: Year to convert to\n    \n    Returns:\n        Inflation-adjusted amount\n    \"\"\"\n    return amount * calculate_inflation_multiplier(from_year, to_year)\n\n# Display inflation adjustments\nprint(\"=\" * 80)\nprint(\"INFLATION ADJUSTMENT FACTORS\")\nprint(\"=\" * 80)\nprint(f\"\\nBase Year: {BASE_YEAR}\")\nprint(f\"Current Year: {CURRENT_YEAR}\\n\")\nprint(\"Annual Inflation Rates:\")\nfor year, rate in sorted(INFLATION_RATES.items()):\n    if year >= 2020:\n        print(f\"  {year}: {rate}%\")\n\ncumulative_2024_to_2026 = calculate_inflation_multiplier(2024, 2026)\nprint(f\"\\nCumulative inflation {BASE_YEAR} to {CURRENT_YEAR}: {(cumulative_2024_to_2026 - 1) * 100:.2f}%\")\nprint(f\"Multiplier: {cumulative_2024_to_2026:.4f}\")\nprint(f\"Example: $100 in {BASE_YEAR} = ${100 * cumulative_2024_to_2026:.2f} in {CURRENT_YEAR}\")\nprint(\"=\" * 80 + \"\\n\")\n\n# ============================================================================\n# DATA DEFINITION - PA County Level\n# ============================================================================\n\n# Pennsylvania county data with population and regional classifications\npa_counties = {\n    'County': ['Philadelphia', 'Allegheny', 'Montgomery', 'Bucks', 'Delaware', 'Chester', \n               'Lancaster', 'York', 'Berks', 'Westmoreland', 'Luzerne', 'Lackawanna',\n               'Erie', 'Lehigh', 'Northampton', 'Dauphin', 'Cumberland', 'Washington',\n               'Butler', 'Cambria', 'Beaver', 'Lebanon', 'Fayette', 'Schuylkill',\n               'Monroe', 'Centre', 'Blair', 'Mercer', 'Lawrence', 'Crawford',\n               'Lycoming', 'Armstrong', 'Indiana', 'Clearfield', 'Somerset', 'Wayne',\n               'Pike', 'Columbia', 'Bradford', 'Carbon', 'Venango', 'Union',\n               'Tioga', 'Clarion', 'Huntingdon', 'Jefferson', 'Clinton', 'Wyoming',\n               'Warren', 'McKean', 'Greene', 'Susquehanna', 'Mifflin', 'Potter',\n               'Juniata', 'Snyder', 'Perry', 'Montour', 'Fulton', 'Sullivan',\n               'Forest', 'Elk', 'Cameron'],\n    'Population_2024': [1573916, 1231814, 879190, 650131, 584882, 540711,\n                       556651, 456203, 425328, 349331, 321791, 217066,\n                       269728, 370614, 312951, 284983, 260091, 209349,\n                       188472, 132853, 165160, 141735, 128804, 143618,\n                       171826, 163023, 123089, 109763, 85656, 84894,\n                       114188, 65558, 84463, 78597, 74129, 51546,\n                       57369, 65163, 60281, 63639, 51074, 45559,\n                       41144, 38734, 45342, 44492, 37931, 26420,\n                       40187, 40625, 38686, 39702, 46138, 16301,\n                       24692, 40683, 46299, 18240, 14845, 5840,\n                       6938, 30398, 4547],\n    'Region': ['Southeast', 'Southwest', 'Southeast', 'Southeast', 'Southeast', 'Southeast',\n               'Southcentral', 'Southcentral', 'Southeast', 'Southwest', 'Northeast', 'Northeast',\n               'Northwest', 'Northeast', 'Northeast', 'Southcentral', 'Southcentral', 'Southwest',\n               'Northwest', 'Southcentral', 'Northwest', 'Southcentral', 'Southwest', 'Northeast',\n               'Northeast', 'Northcentral', 'Southcentral', 'Northwest', 'Northwest', 'Northwest',\n               'Northcentral', 'Northwest', 'Southwest', 'Northcentral', 'Southwest', 'Northeast',\n               'Northeast', 'Northcentral', 'Northeast', 'Northeast', 'Northwest', 'Northcentral',\n               'Northcentral', 'Northwest', 'Southcentral', 'Northwest', 'Northcentral', 'Northeast',\n               'Northwest', 'Northwest', 'Southwest', 'Northeast', 'Southcentral', 'Northcentral',\n               'Southcentral', 'Northcentral', 'Southcentral', 'Northcentral', 'Southcentral', 'Northcentral',\n               'Northwest', 'Northcentral', 'Northcentral'],\n    'Cost_of_Living_Index': [128.5, 98.7, 118.2, 115.4, 116.8, 119.3,\n                            102.1, 99.8, 103.4, 96.5, 94.2, 95.8,\n                            93.4, 104.7, 103.9, 101.5, 102.8, 95.1,\n                            98.9, 92.8, 95.4, 100.3, 91.7, 92.5,\n                            105.8, 99.4, 93.1, 92.9, 91.8, 90.2,\n                            93.7, 89.5, 92.1, 88.7, 89.9, 98.6,\n                            107.2, 94.1, 91.3, 96.7, 88.9, 97.3,\n                            89.8, 87.4, 88.2, 87.8, 89.1, 93.5,\n                            88.4, 87.9, 90.8, 94.6, 91.5, 86.7,\n                            89.7, 92.4, 95.2, 94.8, 88.5, 90.1,\n                            93.8, 88.6, 87.2]\n}\n\n# ============================================================================\n# BEST-PRACTICE ELASTICITY ESTIMATES\n# Source: Havranek, Irsova & Zeynalov (2018) Meta-Analysis\n# ============================================================================\n\nelasticity_estimates = {\n    'Overall_Mean': -0.037,\n    'Private_Universities': -0.167,\n    'Public_Universities': 0.003,\n    'Male_Students': -0.361,\n    'Female_Students': -0.017,\n    'Long_Run': -0.062,\n    'Short_Run': -0.010\n}\n\n# ============================================================================\n# ROI MULTIPLIERS & TUITION (2024 Dollars)\n# ============================================================================\n\n# Average tuition in PA (2024 dollars)\navg_tuition_public_4yr_2024 = 15240\navg_tuition_private_4yr_2024 = 41900\navg_tuition_community_2024 = 6140\npa_weighted_tuition_2024 = 21418\n\n# Adjust to current year\navg_tuition_public_4yr = adjust_for_inflation(avg_tuition_public_4yr_2024)\navg_tuition_private_4yr = adjust_for_inflation(avg_tuition_private_4yr_2024)\navg_tuition_community = adjust_for_inflation(avg_tuition_community_2024)\npa_weighted_tuition = adjust_for_inflation(pa_weighted_tuition_2024)\n\n# Direct spending multiplier\ndirect_spending_multiplier = 2.20\n\n# Employment multiplier\nemployment_multiplier = 1.65\n\n# ============================================================================\n# CALCULATIONS\n# ============================================================================\n\ndef calculate_county_metrics(df, use_inflation_adjusted=True):\n    \"\"\"Calculate enrollment and economic impact metrics for each county\"\"\"\n    \n    # Regional enrollment rates\n    enrollment_rates = {\n        'Southeast': 0.52,\n        'Southwest': 0.48,\n        'Northeast': 0.42,\n        'Southcentral': 0.45,\n        'Northwest': 0.38,\n        'Northcentral': 0.35\n    }\n    \n    # Calculate college-age population (18-24, ~9% of total)\n    df['College_Age_Pop'] = (df['Population_2024'] * 0.09).astype(int)\n    \n    # Map enrollment rates and calculate enrollment\n    df['Enrollment_Rate'] = df['Region'].map(enrollment_rates)\n    df['Estimated_Enrollment'] = (df['College_Age_Pop'] * df['Enrollment_Rate']).astype(int)\n    \n    # Select tuition value (inflation-adjusted or base year)\n    tuition = pa_weighted_tuition if use_inflation_adjusted else pa_weighted_tuition_2024\n    \n    # Economic impact calculations\n    df['Direct_Spending'] = df['Estimated_Enrollment'] * tuition * direct_spending_multiplier\n    df['Total_Economic_Impact'] = df['Direct_Spending'] * employment_multiplier\n    \n    # Tax revenue calculations (8% state, 4% local)\n    df['State_Tax_Revenue'] = df['Direct_Spending'] * 0.08\n    df['Local_Tax_Revenue'] = df['Direct_Spending'] * 0.04\n    df['Total_Tax_Revenue'] = df['State_Tax_Revenue'] + df['Local_Tax_Revenue']\n    \n    return df\n\ndef calculate_regional_summary(df):\n    \"\"\"Aggregate county data to regional level\"\"\"\n    \n    regional = df.groupby('Region').agg({\n        'Estimated_Enrollment': 'sum',\n        'Total_Economic_Impact': 'sum',\n        'State_Tax_Revenue': 'sum',\n        'Local_Tax_Revenue': 'sum',\n        'Total_Tax_Revenue': 'sum',\n        'Cost_of_Living_Index': 'mean',\n        'County': 'count'\n    }).round(2)\n    \n    regional.columns = ['Total_Enrollment', 'Economic_Impact', 'State_Tax', \n                       'Local_Tax', 'Total_Tax', 'Avg_COL_Index', 'Num_Counties']\n    \n    return regional.sort_values('Economic_Impact', ascending=False)\n\n# ============================================================================\n# MAIN ANALYSIS\n# ============================================================================\n\nif __name__ == \"__main__\":\n    \n    # Create DataFrame\n    df = pd.DataFrame(pa_counties)\n    \n    # Calculate metrics with inflation adjustment\n    df_adjusted = calculate_county_metrics(df.copy(), use_inflation_adjusted=True)\n    df_base = calculate_county_metrics(df.copy(), use_inflation_adjusted=False)\n    \n    # Regional summaries\n    regional_adjusted = calculate_regional_summary(df_adjusted)\n    regional_base = calculate_regional_summary(df_base)\n    \n    # ========================================================================\n    # PRINT RESULTS\n    # ========================================================================\n    \n    print(\"=\" * 80)\n    print(\"PENNSYLVANIA HIGHER EDUCATION ECONOMIC IMPACT ANALYSIS\")\n    print(\"County-Level Analysis with Best-Practice Elasticity & Inflation Adjustment\")\n    print(\"=\" * 80)\n    \n    print(f\"\\nTUITION VALUES:\")\n    print(f\"  Public 4-year ({BASE_YEAR}): ${avg_tuition_public_4yr_2024:,.0f}\")\n    print(f\"  Public 4-year ({CURRENT_YEAR}): ${avg_tuition_public_4yr:,.0f}\")\n    print(f\"  Private 4-year ({BASE_YEAR}): ${avg_tuition_private_4yr_2024:,.0f}\")\n    print(f\"  Private 4-year ({CURRENT_YEAR}): ${avg_tuition_private_4yr:,.0f}\")\n    print(f\"  Community college ({BASE_YEAR}): ${avg_tuition_community_2024:,.0f}\")\n    print(f\"  Community college ({CURRENT_YEAR}): ${avg_tuition_community:,.0f}\")\n    print(f\"  Weighted average ({BASE_YEAR}): ${pa_weighted_tuition_2024:,.0f}\")\n    print(f\"  Weighted average ({CURRENT_YEAR}): ${pa_weighted_tuition:,.0f}\")\n    \n    print(f\"\\nSTATEWIDE SUMMARY ({CURRENT_YEAR} Dollars):\")\n    print(f\"  Total PA Population: {df_adjusted['Population_2024'].sum():,}\")\n    print(f\"  Total College-Age Population: {df_adjusted['College_Age_Pop'].sum():,}\")\n    print(f\"  Total Estimated Enrollment: {df_adjusted['Estimated_Enrollment'].sum():,}\")\n    print(f\"  Total Economic Impact: ${df_adjusted['Total_Economic_Impact'].sum()/1e9:.2f}B\")\n    print(f\"  Total Tax Revenue: ${df_adjusted['Total_Tax_Revenue'].sum()/1e9:.2f}B\")\n    \n    print(f\"\\nCOMPARISON ({BASE_YEAR} vs {CURRENT_YEAR} Dollars):\")\n    print(f\"  Economic Impact ({BASE_YEAR}): ${df_base['Total_Economic_Impact'].sum()/1e9:.2f}B\")\n    print(f\"  Economic Impact ({CURRENT_YEAR}): ${df_adjusted['Total_Economic_Impact'].sum()/1e9:.2f}B\")\n    print(f\"  Difference: ${(df_adjusted['Total_Economic_Impact'].sum() - df_base['Total_Economic_Impact'].sum())/1e9:.2f}B ({((df_adjusted['Total_Economic_Impact'].sum() / df_base['Total_Economic_Impact'].sum()) - 1) * 100:.2f}%)\")\n    \n    print(\"\\n\" + \"=\" * 80)\n    print(f\"REGIONAL SUMMARY ({CURRENT_YEAR} Dollars):\")\n    print(\"=\" * 80)\n    print(regional_adjusted.to_string())\n    \n    print(\"\\n\" + \"=\" * 80)\n    print(\"TOP 15 COUNTIES BY ENROLLMENT:\")\n    print(\"=\" * 80)\n    top15 = df_adjusted.nlargest(15, 'Estimated_Enrollment')[\n        ['County', 'Region', 'Estimated_Enrollment', 'Total_Economic_Impact', 'Total_Tax_Revenue']\n    ]\n    top15['Total_Economic_Impact'] = top15['Total_Economic_Impact'] / 1e6\n    top15['Total_Tax_Revenue'] = top15['Total_Tax_Revenue'] / 1e6\n    top15.columns = ['County', 'Region', 'Enrollment', 'Econ_Impact($M)', 'Tax_Revenue($M)']\n    print(top15.to_string(index=False))\n    \n    print(\"\\n\" + \"=\" * 80)\n    print(\"ELASTICITY ESTIMATES (Havranek et al. 2018):\")\n    print(\"=\" * 80)\n    for key, value in elasticity_estimates.items():\n        print(f\"  {key.replace('_', ' ')}: {value:.3f}\")\n    \n    # ========================================================================\n    # SAVE OUTPUT FILES\n    # ========================================================================\n    \n    output_dir = Path('output')\n    output_dir.mkdir(exist_ok=True)\n    \n    df_adjusted.to_csv(output_dir / f'PA_County_Analysis_{CURRENT_YEAR}_Dollars.csv', index=False)\n    df_base.to_csv(output_dir / f'PA_County_Analysis_{BASE_YEAR}_Dollars.csv', index=False)\n    regional_adjusted.to_csv(output_dir / f'PA_Regional_Summary_{CURRENT_YEAR}_Dollars.csv')\n    regional_base.to_csv(output_dir / f'PA_Regional_Summary_{BASE_YEAR}_Dollars.csv')\n    \n    print(\"\\n\" + \"=\" * 80)\n    print(\"FILES SAVED:\")\n    print(f\"  - output/PA_County_Analysis_{CURRENT_YEAR}_Dollars.csv\")\n    print(f\"  - output/PA_County_Analysis_{BASE_YEAR}_Dollars.csv\")\n    print(f\"  - output/PA_Regional_Summary_{CURRENT_YEAR}_Dollars.csv\")\n    print(f\"  - output/PA_Regional_Summary_{BASE_YEAR}_Dollars.csv\")\n    print(\"=\" * 80)\n    \n    # ========================================================================\n    # VISUALIZATIONS\n    # ========================================================================\n    \n    # Figure 1: Regional Economic Impact (Inflation-Adjusted)\n    fig, ax = plt.subplots(figsize=(12, 6))\n    regions = regional_adjusted.index\n    impacts = regional_adjusted['Economic_Impact'] / 1e9\n    colors = plt.cm.viridis(np.linspace(0.3, 0.9, len(regions)))\n    \n    bars = ax.barh(regions, impacts, color=colors)\n    ax.set_xlabel(f'Total Economic Impact (Billion {CURRENT_YEAR} $)', fontsize=12)\n    ax.set_title(f'Total Economic Impact by PA Region ({CURRENT_YEAR})', fontsize=14, fontweight='bold')\n    ax.grid(axis='x', alpha=0.3)\n    \n    for i, (bar, val) in enumerate(zip(bars, impacts)):\n        ax.text(val + 0.3, bar.get_y() + bar.get_height()/2, \n               f'${val:.1f}B', va='center', fontsize=10)\n    \n    plt.tight_layout()\n    plt.savefig(output_dir / f'Regional_Economic_Impact_{CURRENT_YEAR}.png', dpi=300, bbox_inches='tight')\n    plt.close()\n    \n    # Figure 2: Inflation Comparison\n    fig, ax = plt.subplots(figsize=(12, 6))\n    \n    regions = regional_base.index\n    base_impacts = regional_base['Economic_Impact'] / 1e9\n    adjusted_impacts = regional_adjusted['Economic_Impact'] / 1e9\n    \n    x = np.arange(len(regions))\n    width = 0.35\n    \n    bars1 = ax.bar(x - width/2, base_impacts, width, label=f'{BASE_YEAR} Dollars', color='#3498db')\n    bars2 = ax.bar(x + width/2, adjusted_impacts, width, label=f'{CURRENT_YEAR} Dollars', color='#e74c3c')\n    \n    ax.set_xlabel('Region', fontsize=12)\n    ax.set_ylabel('Total Economic Impact (Billion $)', fontsize=12)\n    ax.set_title(f'Economic Impact: {BASE_YEAR} vs {CURRENT_YEAR} Dollars', fontsize=14, fontweight='bold')\n    ax.set_xticks(x)\n    ax.set_xticklabels(regions, rotation=20)\n    ax.legend()\n    ax.grid(axis='y', alpha=0.3)\n    \n    plt.tight_layout()\n    plt.savefig(output_dir / 'Inflation_Comparison.png', dpi=300, bbox_inches='tight')\n    plt.close()\n    \n    print(\"\\nVISUALIZATIONS SAVED:\")\n    print(f\"  - output/Regional_Economic_Impact_{CURRENT_YEAR}.png\")\n    print(\"  - output/Inflation_Comparison.png\")\n    print(\"=\" * 80)\n